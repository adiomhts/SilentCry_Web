<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% endblock %} - Silent Cry</title>

    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="{{ url_for('static', filename='css/style.css') }}" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='img/favicon.ico') }}">

    <!-- Klaro Consent Manager Configuration -->
    <script defer type="application/javascript">
        var klaroConfig = {
            elementID: 'klaro',
            storageMethod: 'cookie',
            cookieExpiresAfterDays: 365,
            default: false,
            mustConsent: true,
            acceptAll: true,
            hideDeclineAll: false,
            lang: 'en',
            translations: {
                cs: {
                    consentModal: {
                        title: 'Používáme cookies',
                        description: 'Používáme cookies, abychom zjistili, kolik lidí navštěvuje náš web.'
                    },
                    consentNotice: {
                        description: 'Používáme cookies ke sledování návštěvnosti. Můžete si upravit nastavení.',
                        learnMore: 'Více informací',
                        acceptAll: 'Přijmout vše',
                        decline: 'Odmítnout'
                    },
                    purposes: {
                        analytics: 'Analýza',
                        marketing: 'Marketing'
                    },
                    services: {
                        'google-analytics': {
                            description: 'Slouží ke sledování návštěvnosti anonymně.'
                        },
                        'google-tag-manager': {
                            description: 'Slouží k načtení analytických skriptů.'
                        }
                    },
                    ok: 'OK',
                    save: 'Uložit',
                    acceptSelected: 'Přijmout vybrané',
                    acceptAll: 'Přijmout vše',
                    declineAll: 'Odmítnout vše',
                    disableAll: {
                        title: 'Vypnout všechny služby',
                        description: 'Pomocí tohoto přepínače vypnete všechny doplňkové služby.'
                    },
                    poweredBy: 'Funguje díky Klaro!'
                },
                ru: {
                    consentModal: {
                        title: 'Мы используем куки',
                        description: 'Мы используем куки, чтобы узнать, сколько людей посещают наш сайт.'
                    },
                    consentNotice: {
                        description: 'Мы используем куки для подсчёта посещений. Вы можете изменить настройки.',
                        learnMore: 'Подробнее',
                        acceptAll: 'Принять всё',
                        decline: 'Отклонить'
                    },
                    purposes: {
                        analytics: 'Аналитика',
                        marketing: 'Маркетинг'
                    },
                    services: {
                        'google-analytics': {
                            description: 'Используется для анонимного подсчёта посещений.'
                        },
                        'google-tag-manager': {
                            description: 'Используется для загрузки аналитических скриптов.'
                        }
                    },
                    ok: 'ОК',
                    save: 'Сохранить',
                    acceptSelected: 'Принять выбранное',
                    acceptAll: 'Принять всё',
                    declineAll: 'Отклонить всё',
                    disableAll: {
                        title: 'Отключить все сервисы',
                        description: 'Используйте этот переключатель, чтобы отключить все дополнительные сервисы.'
                    },
                    poweredBy: 'Работает на Klaro!'
                },
                en: {
                    consentModal: {
                        title: 'We use cookies',
                        description: 'We use cookies to understand how many people visit our site.'
                    },
                    consentNotice: {
                        description: 'We use cookies to understand traffic. You can manage your preferences.',
                        learnMore: 'More info',
                        acceptAll: 'Accept all',
                        decline: 'Decline'
                    },
                    purposes: {
                        analytics: 'Analytics',
                        marketing: 'Marketing'
                    },
                    services: {
                        'google-analytics': {
                            description: 'Used to track site traffic anonymously.'
                        },
                        'google-tag-manager': {
                            description: 'Used to load analytics scripts.'
                        }
                    }
                },
                cs: {
                    consentModal: {
                        title: 'Používáme cookies',
                        description: 'Používáme cookies, abychom zjistili, kolik lidí navštěvuje náš web.'
                    },
                    consentNotice: {
                        description: 'Používáme cookies ke sledování návštěvnosti. Můžete si upravit nastavení.',
                        learnMore: 'Více informací',
                        acceptAll: 'Přijmout vše',
                        decline: 'Odmítnout'
                    },
                    purposes: {
                        analytics: 'Analýza',
                        marketing: 'Marketing'
                    },
                    services: {
                        'google-analytics': {
                            description: 'Slouží ke sledování návštěvnosti anonymně.'
                        },
                        'google-tag-manager': {
                            description: 'Slouží k načtení analytických skriptů.'
                        }
                    }
                },
                ru: {
                    consentModal: {
                        title: 'Мы используем куки',
                        description: 'Мы используем куки, чтобы узнать, сколько людей посещают наш сайт.'
                    },
                    consentNotice: {
                        description: 'Мы используем куки для подсчёта посещений. Вы можете изменить настройки.',
                        learnMore: 'Подробнее',
                        acceptAll: 'Принять всё',
                        decline: 'Отклонить'
                    },
                    purposes: {
                        analytics: 'Аналитика',
                        marketing: 'Маркетинг'
                    },
                    services: {
                        'google-analytics': {
                            description: 'Используется для анонимного подсчёта посещений.'
                        },
                        'google-tag-manager': {
                            description: 'Используется для загрузки аналитических скриптов.'
                        }
                    }
                }
            },
            services: [
                {
                    name: 'google-tag-manager',
                    title: 'Google Tag Manager',
                    purposes: ['marketing'],
                    required: false,
                    cookies: [],
                    onInit: function() {
                        window.dataLayer = window.dataLayer || [];
                        window.gtag = function(){dataLayer.push(arguments);}
                        gtag('consent', 'default', {
                            'ad_storage': 'denied',
                            'analytics_storage': 'denied'
                        });
                    },
                    onAccept: function() {
                        var gtagScript = document.createElement('script');
                        gtagScript.async = true;
                        gtagScript.src = 'https://www.googletagmanager.com/gtag/js?id=G-V41VK6G6NK';
                        gtagScript.onload = function() {
                            window.dataLayer = window.dataLayer || [];
                            window.gtag = function(){dataLayer.push(arguments);}
                            gtag('js', new Date());
                            gtag('config', 'G-V41VK6G6NK');
                            gtag('consent', 'update', {
                                'analytics_storage': 'granted'
                            });
                        };
                        document.head.appendChild(gtagScript);
                    },
                    onDecline: function() {
                        gtag('consent', 'update', {
                            'analytics_storage': 'denied'
                        });
                    }
                },
                {
                    name: 'google-analytics',
                    title: 'Google Analytics',
                    purposes: ['analytics'],
                    cookies: [/^_ga/, /^_gid/, /^_gat/],
                    required: false,
                    onAccept: function() {
                        gtag('consent', 'update', {
                            'analytics_storage': 'granted'
                        });
                    },
                    onDecline: function() {
                        gtag('consent', 'update', {
                            'analytics_storage': 'denied'
                        });
                    }
                }
            ]
        };
    </script>
    <script defer src="https://cdn.kiprotect.com/klaro/v0.7.11/klaro.js"></script>

    {% block extra_head %}{% endblock %}
</head>
<body>
    {% include 'navbar.html' %}

    {% block content %}{% endblock %}

    {% include 'footer.html' %}

    <div class="cookie-banner">
        <button class="bg-red-500 text-white px-4 py-2 rounded" onclick="klaro.show()">
            {{ gettext('Cookies settings') }}
        </button>
    </div>

    <div id="fullscreen-modal" class="hidden fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center p-4">
        <img id="fullscreen-image" class="max-h-full max-w-full object-contain">
        <button id="close-modal" class="absolute top-4 right-4 text-white text-4xl hover:text-red-500 transition-colors">
            &times;
        </button>
    </div>

    <script>
        window.currentLang = '{{ lang }}';
    </script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
