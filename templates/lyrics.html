{% extends 'base.html' %}
{% block title %}{{ gettext('Silent Cry - Texty písní') }}{% endblock %}
{% block extra_head %}
<script src="https://unpkg.com/wavesurfer.js@7"></script>
{% endblock %}
{% block content %}
<section class="section">
    <h2>{{ gettext('Texty našich písní') }}</h2>
    {% for filename, data in lyrics_content.items() %}
        <div class="song-container" data-audio="{{ url_for('static', filename='audio/' + filename.replace('.txt', '.mp3')) }}">
            <h2>{{ filename.replace('.txt', '') }}</h2>
            <div class="audio-player">
                <div id="waveform-{{ loop.index }}" class="waveform"></div>
                <div class="audio-controls">
                    <button class="play-btn bg-red-500 text-white px-4 py-2 rounded">
                        {{ gettext('Play') }}
                    </button>
                    <span class="time">0:00</span>
                    <a href="{{ url_for('static', filename='audio/' + filename.replace('.txt', '.flac')) }}" 
                       class="download-link">
                        {{ gettext('Download FLAC') }}
                    </a>
                </div>
            </div>
            {% if data.description %}
                <p class="text-lg text-center max-w-3xl mx-auto animate-on-scroll">{{ gettext(data.description) }}</p><br>
            {% endif %}
            <pre class="lyrics-text">{{ data.content }}</pre>
        </div>
    {% endfor %}
</section>
{% endblock %}
{% block extra_scripts %}
<script>
    document.querySelectorAll('.song-container').forEach((container, index) => {
        const wavesurfer = WaveSurfer.create({
            container: container.querySelector('.waveform'),
            waveColor: '#b91c1c',
            progressColor: '#fff',
            cursorColor: '#fff',
            height: 80,
            barWidth: 2,
            responsive: true,
            url: container.dataset.audio
        });
        const playBtn = container.querySelector('.play-btn');
        const timeEl = container.querySelector('.time');
        playBtn.addEventListener('click', () => {
            wavesurfer.playPause();
            playBtn.textContent = wavesurfer.isPlaying() ? 
                '{{ gettext("Pause") }}' : '{{ gettext("Play") }}';
        });
        wavesurfer.on('timeupdate', () => {
            const minutes = Math.floor(wavesurfer.getCurrentTime() / 60);
            const seconds = Math.floor(wavesurfer.getCurrentTime() % 60);
            timeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        });
    });
</script>
{% endblock %}