{% extends 'base.html' %}
{% block title %}{{ gettext('Silent Cry - Texty písní') }}{% endblock %}
{% block extra_head %}
<script src="https://unpkg.com/wavesurfer.js@7"></script>
{% endblock %}
{% block content %}
<section class="section">
    <h2>{{ gettext('Texty našich písní') }}</h2>
    <div class="max-w-5xl mx-auto">
    {% for release in releases %}
        <div class="release-block p-4 my-4 rounded">
            <div class="release-header flex items-center gap-4">
                {% if release.cover %}
                    <img src="{{ url_for('static', filename=release.cover) }}" alt="{{ release.name }} cover" class="w-24 h-24 object-cover rounded">
                {% endif %}
                {# Make release title clickable: link to player and start at first song #}
                {% if release.songs and release.songs[0] %}
                    <h3 class="text-2xl font-bold">
                        <a href="{{ url_for('player', release_slug=release.slug, song=release.songs[0].slug) }}" class="text-red-400 hover:underline">{{ release.name }}</a>
                    </h3>
                {% else %}
                    <h3 class="text-2xl font-bold">{{ release.name }}</h3>
                {% endif %}
            </div>
            <ul class="mt-3 ml-6 list-disc release-songs">
                {% for song in release.songs %}
                    <li>
                        <a href="{{ url_for('player', release_slug=release.slug, song=song.slug) }}" class="text-red-500 hover:underline">
                            {{ song.filename.replace('.txt', '') }}
                        </a>
                        {% if not song.has_audio %}
                            <span class="text-sm text-gray-400">({{ gettext('audio not available') }})</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ul>
        </div>
    {% endfor %}
    </div>
</section>
{% endblock %}
{% block extra_scripts %}
<script>
    document.querySelectorAll('.song-container').forEach((container, index) => {
        const wavesurfer = WaveSurfer.create({
            container: container.querySelector('.waveform'),
            waveColor: '#b91c1c',
            progressColor: '#fff',
            cursorColor: '#fff',
            height: 80,
            barWidth: 2,
            responsive: true,
            url: container.dataset.audio
        });
        const playBtn = container.querySelector('.play-btn');
        const timeEl = container.querySelector('.time');
        playBtn.addEventListener('click', () => {
            wavesurfer.playPause();
            playBtn.textContent = wavesurfer.isPlaying() ? 
                '{{ gettext("Pause") }}' : '{{ gettext("Play") }}';
        });
        wavesurfer.on('timeupdate', () => {
            const minutes = Math.floor(wavesurfer.getCurrentTime() / 60);
            const seconds = Math.floor(wavesurfer.getCurrentTime() % 60);
            timeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
        });
    });
</script>
{% endblock %}